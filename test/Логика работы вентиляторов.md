# Описание


## Доступные режимы
bool sensorAvailable                        // Доступен датчик
bool controlAvailable                       // Доступно управление по mqtt

|-------------------------------------|-------------------------------------------------------------|
|(sensorAvailable && controlAvailable)    | Управление вентилятором по mqtt и по показаниям датчика     |
|(sensorAvailable && !controlAvailable)   | Управление по датчику, mqtt не доступен                     |
|(!sensorAvailable && controlAvailable)   | Управление по mqtt, датчика нет                             |
|(!sensorAvailable && !controlAvailable)  | Управление недоступно, датчика нет, регулировка по времени  |
|-------------------------------------|-------------------------------------------------------------




# Логика работы вентиляторов

Если найден сенсор, включить режим _offlineMode_
Если есть подходящая wifi точка, выключить режим offlineMode
  + Если установлено соединение с mqtt включить режим mqttMode


1. Инициализация порта и переменных
2. Поиск датчика. Если не найден - перейти в режим работы по таймеру.
    Если датчик найден,

3. Поиск сети в течении 10 секунд. Если не найдена - перейти в режим офлайн, иначе подключиться к сети
4. Подключение к брокеру.
5.



## Ванная комната

1. Проверить подключение датчика
2. Попытка соединиться с wifi.
  2.1. Если не удалось выполнить соединение с wifi, запустить точку доступа и создать сервер с возможностью установки параметров доступа (ssid, password).
  После успешного соединения параметры записываются в EEPROM


При включении питания вентилятор включается на startTime сек, всасывает воздух и измеряет его параметры.
При достижении заданных значений температуры и влажности включается или выключается вентилятор. Если вентилятор выключен, он периодически включается и измеряет влажность, после чего устанавливается соответствующий режим.
Также после первого запуска отправляется сообщение на сервер mqtt



Поднимается web-сервер для возможности прямого ввода значений 



- int startTime
- int checkPeriod

- int tempOn
- int tempHisteresis
- bool tempUsing

- int humOn
- int humHisteresis
- bool humUsing

- int timeOn
- int timeHisteresis
- bool timeUsing

- int webServerLive
- bool webServerLiveUsing
- 

1. Включается питание, останавливается вентилятор
2. Устанавливается низкая скорость вентилятора
3. Производится измерение влажности
4. Устанавливается необходимая скорость вентилятора
5. Выполняется отсчет таймера repeatCycle
6. Переход к шагу 3.

### Туалет
Вентилятор включается по прошествии заданного времени. Желательно анализировать воздух.
1. Включается питание, останавливается вентилятор
2. Устанавливается низкая скорость вентилятора
3. Отсчитывается необходимый интервал времени
4. Вентилятор повышает скорость
5. Переход к шагу 3


# Дерево mqtt

<dev_type><dev_id><commands><param_id>
<dev_type><dev_id><status><param_id>

RELAYS - RELAY1 - COMMANDS - "ON/OFF"
                - STATUS - "ON/OFF"

FANS - FAN1 - COMMANDS - RelayState
                       - TempOn
                       - TempOff
                       - TempUsage
            - STATE    - Temperature
                       - Hummidity
                       - RelayState
